<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="index.css" />
    <title>LIFF Starter</title>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
<!--
    <script src="https://static.line-scdn.net/liff/edge/2/non-ios-extensions_2_22_0.js" type="text/javascript"></script>
    <script src="https://static.line-scdn.net/liff/sdk/v2/liff.js"></script>
-->
  </head>
  <body>
    <h1>LINE LIFFアプリ デモ</h1>
    <div>
      <p>ステータス: <span id="status">初期化中...</span><button onclick="click_login()">ログイン</button><button onclick="click_logout()">ログアウト</button></p>
    </div>
    
     <p>以下の項目で(*)がつくものは、ログインしていなくても利用できる</p>
    
    <div>
      <p>あなたの表示名: <span id="display-name"></span><button onclick="click_LiffProfile()">更新</button></p>
    </div>
    <div>
      <p>OS(*): <span id="os"></span><button onclick="click_OS()">更新</button></p>
    </div>
     <div>
      <p>LINEアプリの言語(*): <span id="app-language"></span><button onclick="click_AppLang()">更新</button></p>
    </div>
     <div>
      <p>LIFF SDKのバージョン(*): <span id="sdk-version"></span><button onclick="click_SdkVersion()">更新</button></p>
    </div>
     <div>
      <p>LINE のバージョン(*): <span id="line-version"></span><button onclick="click_LineVersion()">更新</button></p>
    </div>
     <div>
      <p>LIFFブラウザの確認(*): <span id="isInClient"></span><button onclick="click_IsInClient()">更新</button></p>
    </div>



    <!--
    // スクリプト
    -->
    <script>
        // ★ あなたのLIFF IDに置き換えてください
        const MY_LIFF_ID = "2008528173-Q0Ppe5X7"; 
        
        /*
          LIFF APIでエラーを返すときは、LiffErrorオブジェクトが返る
          {
            code: string エラーコード
            message: string エラーメッセージ
            cause: Unknown(含まれないことがある） エラーの原因
          }
          
          https://developers.line.biz/ja/reference/liff/#liff-errors
        */

        /**
         * LIFF初期化処理
         */
        function initializeLiff() {
            liff.init({
                liffId: MY_LIFF_ID
            })
            .then(() => {
                document.getElementById('status').textContent = '初期化成功';
                // LIFF初期化が成功したら、次のステップへ
                checkLoginStatus();
            })
            .catch((err) => {
                document.getElementById('status').textContent = `初期化エラー: ${err.code}`;
                console.error("LIFF Initialization failed", err);
            });
        }

        /**
         * ログイン状態の確認と処理の分岐
         */
        function checkLoginStatus() {
            if (liff.isLoggedIn()) {
                document.getElementById('status').textContent = 'ログイン済み';
            } else {
                document.getElementById('status').textContent = '未ログイン';
                // 未ログインであれば、ログイン画面へリダイレクト
                liff.login();
            }
        }
        
        function update_status() {
            document.getElementById('status').textContent = liff.isLoggedIn() ? 'ログイン' : '未ログイン';
            getLiffProfile();
        }
        
        //
        // ログイン(liff.login)
        //
        function click_login() {
            if (liff.isLoggedIn()) return;

            liff.login();
            update_status();
        }
        
        //
        // ログアウト(liff.logout)
        //
        function click_logout() {
            if (!liff.isLoggedIn()) return;
            
            liff.logout();
            
/*
            // promiseを使ってlogoutを呼び出しにすると
            // Uncaught TypeError: can't access property "then", liff.logout() is undefined
            // が発生する
            liff.logout()
            .then(() => {
                window.location.reload();
            })
            .catch((err) => {
                alert("logout failed.");
            });
*/
            
            update_status();
        }

        //
        // LIFF プロフィール (liff.getProfile()
        //
        function click_LiffProfile() {
            liff.getProfile()
            .then(profile => {
                // プロフィール情報を画面に表示
                document.getElementById('display-name').textContent = profile.displayName;
                console.log('Profile fetched:', profile);
            })
            .catch((err) => {
                document.getElementById('display-name').textContent = 'プロフィールの取得に失敗しました';
                console.error("Error getting profile", err);
            });
        }
        
        //
        // OS(liff.getOS)
        //
        function click_OS() {
          document.getElementById('os').textContent = liff.isLoggedIn()? liff.getOS(): "---";
        }
        
        //
        // LINEアプリの言語(liff.getOS)
        //
        function click_AppLang() {
          // liff.getLanguage()は非推奨となり、liff.getAppLanguageを呼ぶそうです。
          document.getElementById('app-language').textContent = liff.getAppLanguage();
        }
        
        //
        // LIFF SDKのバージョン(liff.getVersion)
        //
        function click_SdkVersion() {
          document.getElementById('sdk-version').textContent = liff.getVersion();
        }
        
        //
        // LINE のバージョン(liff.getLineVersion)
        //
        function click_LineVersion() {
          // LIFFブラウザでは動くが、外部ブラウザでは空文字列
          document.getElementById('line-version').textContent = liff.getLineVersion();
        }

        //
        // LIFFブラウザであるかの確認(liff.isInClient)
        //
        function click_IsInClient() {
          document.getElementById('isInClient').textContent = liff.isInClient()? "LIFFブラウザ": "外部ブラウザ or LINE内ブラウザ";
        }

        // アプリ起動時にLIFF初期化関数を実行
        initializeLiff();
    </script>
  </body>
</html>
